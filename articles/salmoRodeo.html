<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Basic Usage of salmoRodeo • salmoRodeo</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="salmoRodeo_files/libs/quarto-html/popper.min.js"></script><script src="salmoRodeo_files/libs/quarto-html/tippy.umd.min.js"></script><link href="salmoRodeo_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="salmoRodeo_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic Usage of salmoRodeo">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">salmoRodeo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/salmoRodeo.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Basic Usage of salmoRodeo</h1>

      <p class="author">Thomas Petzoldt and Justus Möller</p>
      <p class="date">2025-06-06</p>


      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>SALMO <span class="citation" data-cites="Benndorf1979 Benndorf1982 Recknagel1989">(Simulation by an Analytical Lake Model, <a href="#ref-Benndorf1979" role="doc-biblioref">Benndorf 1979</a>; <a href="#ref-Benndorf1982" role="doc-biblioref">Benndorf and Recknagel 1982</a>; <a href="#ref-Recknagel1989" role="doc-biblioref">Recknagel 1989</a>)</span> and further developed by several authors, e.g. <span class="citation" data-cites="Petzoldt2005">Petzoldt et al. (<a href="#ref-Petzoldt2005" role="doc-biblioref">2005</a>)</span>, <span class="citation" data-cites="Rolinski2005">Rolinski et al. (<a href="#ref-Rolinski2005" role="doc-biblioref">2005</a>)</span> and <span class="citation" data-cites="Sachse2014">Sachse et al. (<a href="#ref-Sachse2014" role="doc-biblioref">2014</a>)</span> is a dynamic ecological model that simulates essential pelagic food web compartments of lakes and reservoirs. Its state variables are soluble reactive phosphorus, inorganic nitrogen, two or three functional phytoplankton groups, zooplankton, oxygen and detritus. Other important, e.g. predation by fish or sediment-water interactions, are included by empirical equations.</p>
<p>Over the years, several “monolithic” implementations and forks have appeared, that have in common to be difficult to maintain. The version provided here was implemented by Justus Möller as part of a study project. It aims to make modificatins and extensions easier by emplying a tabular description of processes and stoichiometry. The code generator package <span class="citation" data-cites="Kneis2017 Kneis2024">(<strong>rodeo</strong>, <a href="#ref-Kneis2017" role="doc-biblioref">Kneis, Petzoldt, and Berendonk 2017</a>; <a href="#ref-Kneis2024" role="doc-biblioref">Kneis 2024</a>)</span> to generate executable code.</p>
<p>This vignette demonstrates the basic setup, execution, and plotting functionalities of the <code>salmoRodeo</code> package. It showcases how to initialize a model, set parameters and initial conditions, run simulations, and visualize results.</p>
</section><section class="level2"><h2 id="setup-and-model-compilation">Setup and Model Compilation<a class="anchor" aria-label="anchor" href="#setup-and-model-compilation"></a>
</h2>
<p>We begin by loading the <code>salmoRodeo</code> package and setting up the model. By default, <code><a href="../reference/model_setup.html">model_setup()</a></code> uses input files from the package’s internal <code>models</code> directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tpetzoldt.github.io/salmoRodeo/">"salmoRodeo"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://desolve.r-forge.r-project.org/" class="external-link">"deSolve"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Setup and compile model using default input files</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_setup.html">model_setup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>You could also specify a local data file if your inputs are not bundled with the package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#model &lt;- model_setup(datafile="inputs.tsv")</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="setting-time-parameters-and-initial-conditions">Setting Time, Parameters, and Initial Conditions<a class="anchor" aria-label="anchor" href="#setting-time-parameters-and-initial-conditions"></a>
</h2>
<p>Next, we define the simulation time steps (e.g. 2 years), initial state variable values, and any custom parameter settings. Note that due to its implementation as a state variable, xsum must be the sum of x1 + x2 + x3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">730</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values for state variables</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_initval.html">set_initval</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">50</span>, n<span class="op">=</span><span class="fl">3</span>, x1<span class="op">=</span><span class="fl">0.1</span>, x2<span class="op">=</span><span class="fl">0.1</span>, x3<span class="op">=</span><span class="fl">0.1</span>, z<span class="op">=</span><span class="fl">0.1</span>, d<span class="op">=</span><span class="fl">1</span>, xsum<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply default parameter values (or provide specific changes if needed)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_pars.html">set_pars</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="optional-cloning-and-altering-parameters-for-comparison">Optional: Cloning and Altering Parameters for Comparison<a class="anchor" aria-label="anchor" href="#optional-cloning-and-altering-parameters-for-comparison"></a>
</h2>
<p>The rodeo package allows you to clone model objects, which is useful for comparing different parameter scenarios without re-compiling the model from scratch. We’ll create a clone and modify a few parameters. Remember that <code><a href="../reference/set_pars.html">set_pars()</a></code> is cumulative if called multiple times on the same objec.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_pars.html">set_pars</a></span><span class="op">(</span><span class="va">model2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>npsfmode <span class="op">=</span> <span class="fl">0</span>, MOMIN <span class="op">=</span> <span class="fl">0.03</span>, MOT<span class="op">=</span><span class="fl">0.012</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify the altered parameters</span></span>
<span><span class="va">model2</span><span class="op">$</span><span class="fu">getPars</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MOMIN"</span>, <span class="st">"MOT"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="running-simulations">Running Simulations<a class="anchor" aria-label="anchor" href="#running-simulations"></a>
</h2>
<p>Now, we run the dynamic simulations for both the original and the cloned models using the specified time steps and solver settings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">dynamics</span><span class="op">(</span>times <span class="op">=</span> <span class="va">times</span>, diagnostics <span class="op">=</span> <span class="cn">TRUE</span>, atol <span class="op">=</span> <span class="fl">1e-8</span>,</span>
<span>                      rtol <span class="op">=</span> <span class="fl">1e-2</span>, method <span class="op">=</span> <span class="st">"adams"</span>, fortran <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="va">model2</span><span class="op">$</span><span class="fu">dynamics</span><span class="op">(</span>times <span class="op">=</span> <span class="va">times</span>, diagnostics <span class="op">=</span> <span class="cn">TRUE</span>, atol <span class="op">=</span> <span class="fl">1e-8</span>,</span>
<span>                        rtol <span class="op">=</span> <span class="fl">1e-2</span>, method <span class="op">=</span> <span class="st">"adams"</span>, fortran <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="visualizing-results-and-diagnostics">Visualizing Results and Diagnostics<a class="anchor" aria-label="anchor" href="#visualizing-results-and-diagnostics"></a>
</h2>
<p>Finally, we plot the output from both simulations to compare the state variable trajectories and run diagnostics to check the model’s performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">out2</span>, which<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>, <span class="st">"n"</span>, <span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"z"</span>, <span class="st">"d"</span>, <span class="st">"xsum"</span>, <span class="st">"pin"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/diagnostics.html" class="external-link">diagnostics</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2 unnumbered"><h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Benndorf1979" class="csl-entry" role="listitem">
Benndorf, J. 1979. <span>“Kausalanalyse, Theoretische <span>S</span>ynthese Und <span>S</span>imulation Des <span>E</span>utrophierungsprozesses in Stehenden Und Gestauten <span>G</span>ewässern.”</span> Habilitationsschrift, TU Dresden, Fakultät Bau-, Wasser- und Forstwesen.
</div>
<div id="ref-Benndorf1982" class="csl-entry" role="listitem">
Benndorf, J., and F. Recknagel. 1982. <span>“Problems of Application of the Ecological Model <span>SALMO</span> to Lakes and Reservoirs Having Various Trophic States.”</span> <em>Ecological Modelling</em> 17: 129–45.
</div>
<div id="ref-Kneis2024" class="csl-entry" role="listitem">
Kneis, David. 2024. <em>Rodeo: A Code Generator for ODE-Based Models</em>. <a href="https://doi.org/10.32614/CRAN.package.rodeo" class="external-link">https://doi.org/10.32614/CRAN.package.rodeo</a>.
</div>
<div id="ref-Kneis2017" class="csl-entry" role="listitem">
Kneis, David, Thomas Petzoldt, and Thomas U. Berendonk. 2017. <span>“An <span class="nocase">R-package</span> to Boost Fitness and Life Expectancy of Environmental Models.”</span> <em>Environmental Modelling &amp; Software</em> 96: 123–27. <a href="https://doi.org/10.1016/j.envsoft.2017.06.036" class="external-link">https://doi.org/10.1016/j.envsoft.2017.06.036</a>.
</div>
<div id="ref-Petzoldt2005" class="csl-entry" role="listitem">
Petzoldt, T., S. Rolinski, K. Rinke, M. König, H. Z. Baumert, and J. Benndorf. 2005. <span>“<span class="nocase">SALMO: Die ökologische Komponente des gekoppelten Modells</span>.”</span> <em>Wasserwirtschaft</em> 95: 28–33.
</div>
<div id="ref-Recknagel1989" class="csl-entry" role="listitem">
Recknagel, Friedrich. 1989. <em>Applied Systems Ecology Approach and Case Studies in Aquatic Ecology</em>. Berlin, Boston: De Gruyter. <a href="https://doi.org/doi:10.1515/9783112650929" class="external-link">https://doi.org/doi:10.1515/9783112650929</a>.
</div>
<div id="ref-Rolinski2005" class="csl-entry" role="listitem">
Rolinski, S., T. Petzoldt, H. Z. Baumert, K Bigalke, H. Horn, and J. Benndorf. 2005. <span>“<span class="nocase">Das physikalisch-ökologisch gekoppelte Talsperrenmodell</span>.”</span> <em>Wasserwirtschaft</em> 95: 34–38.
</div>
<div id="ref-Sachse2014" class="csl-entry" role="listitem">
Sachse, René, Thomas Petzoldt, Maria Blumstock, Santiago Moreira, Marlene Pätzig, Jacqueline Rücker, Jan H. Janse, Wolf M. Mooij, and Sabine Hilt. 2014. <span>“Extending One-Dimensional Models for Deep Lakes to Simulate the Impact of Submerged Macrophytes on Water Quality.”</span> <em>Environmental Modelling &amp; Software</em> 61: 410–23.
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Justus Möller, Thomas Petzoldt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
